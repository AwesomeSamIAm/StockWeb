from twilio.rest import Client
from bs4 import BeautifulSoup #E
import requests #E
from time import sleep #E
from selenium import webdriver
from selenium.webdriver.firefox.options import Options
from timedate import time #j
import date #j
import timedelta #j

global phone
global tPhone
global accountSID
global authToken
global phoneNumber
global twilioPhone
global link
global client
global message
global messageReceived
global options
global firefox_capabilities
global browser
global soup
global currentValue
global percentDifference
global timePrevious


def input():
  
	accountSID = input("Account SID: ") #b

	authToken = input("Authorization Token: ") #b

	phoneNumber = input("Phone Number: ") #b
	twilioPhone = input("Twilio Number: ")
	while (len(phoneNumber) != 10 or not phoneNumber.isdigit()):
  		print("Phone number should be 10 numbers")
  		phoneNumber = input("Phone Number: ") #b
	while (len(twilioPhone) != 10 or not twilioPhone.isdigit()):
  		print("Twilio number should be 10 numbers")
  		twilioPhone = input("Twilio Number: ") #b
	if len(twilioPhone) == 10 && twilioPhone.isdigit()): #j
		tPhone = 1 #j
	else: #j
		tPhone = 0 #j	
	if len(phoneNumber) == 10 && phoneNumber.isdigit()): #j
		Phone = 1 #j
	else:
		Phone = 0 #j
	link = input("NASDAQ Website Link: ") #E 

	client = Client(accountSID,authToken) #j
	message = client.messages.create( #j
  		to = phoneNumber, #j
  		from_ = twilioPhone, #j
  		body = "Did you ever hear the tragedy of Darth Plagueis?(Look at command prompt)") #j
	print(message.sid)# j

	messageReceived = input("Fear leads to anger. Anger leads to hate. Did you receive this message?('yes' or 'no')") #b

	def ask(): #b
  		if (messageReceived == "yes"): #b
  			print("Thanks for using the sytem.") #b
  		elif (messageReceived == "no"): #b
  			main() #b
  		else: #b
  			ask() #b

#if __name__ == "__main__":

def magic():

	# The NASDAQ webpage uses javascript to load the stock price. Without javascript enabled,
	# there's no stock ticker price. In order to get around this, we use Selenium to run Firefox
	# to load the javascript, and get the stock ticker price.

	# To do this, we need Firefox installed, and we need to download geckodriver from
	# https://github.com/mozilla/geckodriver/releases and put the binary in this directory.

	# Import selenium libraries


	# Run firefox without opening a window (headless mode)
	options = Options()
	options.headless = True

	# Tell selenium where firefox and geckodriver are
	firefox_capabilities = webdriver.DesiredCapabilities.FIREFOX
	firefox_capabilities['marionette'] = True
	browser = webdriver.Firefox(options=options, executable_path=r'geckodriver.exe', capabilities=firefox_capabilities)

	# Load and run javascript on webiste
	browser.get("https://www.nasdaq.com/market-activity/stocks/tsla")

	# Beautiful soup scrape stock ticker price
	soup = BeautifulSoup(browser.page_source, "html.parser")
	currentValue = soup.find("span", class_="symbol-page-header__pricing-price").text


	# to get second data set
	#browser.get("https://www.nasdaq.com/market-activity/stocks/tsla")

	# Beautiful soup scrape stock ticker price
	#soup = BeautifulSoup(browser.page_source, "html.parser")
	#currentValue = soup.find("span", class_="symbol-page-header__pricing-price").text #Change current value

	##sleep(1) #Waits the program for X seconds #E
	##newprice = soup.find("span", class_="symbol-page-header__pricing-price") #newprice E

	##while True (price-5) < newprice < (price+5):
	##  sleep(5)
	##  newprice = soup.find("span", class_="symbol-page-header__pricing-price") #newprice E
	##else:
	##  break
	##return newprice
	##return price

	print(currentValue) #E


magic()


def output():
	import requests #E
	from time import sleep #E
	from timedate import time #j
	import date #j
	import timedelta #j
	percentDifference = 5
	timePrevious = "15:30"

	message = client.messages.create(
    	to = phoneNumber,
    	from_= twilioPhone,
    	#body = "The percent difference in stock since " + %s + " is " + %d + "%" % (time_previous, percent_difference)
    	body = "tepitytest" #first %s is time previous second is percent difference
	)
	if (percentDifference >= 5):
		print(message.sid)
  

    #"The percent difference in stock since " + %s + " is " + %d + "%" % (time_previous, percent_difference) #first %s is time previous second is percent difference

output()

def output():
	from time import sleep #E
	from timedate import time #j
	import date #j
	import timedelta #j

	percentDifference = (abs(percentNow - percentPrevious)/percentNow) * 100

	message = client.messages.create(
    	to = phoneNumber,
    	from_= twilioPhone,
    	#body = "The percent difference in stock since " +  + " is " + %d + "%" % (time_previous, percent_difference)
    	body = "The percent difference in stock since " + timePrevious + " is " + percentDifference + "%"
	)
	if (percentDifference >= 5):
		print(message.sid)
#we want this to run multiple times.
output()
